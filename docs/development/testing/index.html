<!doctype html><html prefix="og: https://ogp.me/ns#" data-theme=dark lang=en><head><meta charset=UTF-8><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content="dark light" name=color-scheme><title>Testing | hx Documentation</title><meta content="Documentation for hx, the extremely fast Haskell package and project manager." name=description><meta content="haskell, package manager, documentation, hx, tutorial, guide" name=keywords><meta content=raskell.io name=author><meta content="index, follow" name=robots><meta content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" name=googlebot><link href=https://hx.raskell.io/docs/docs/development/testing/ rel=canonical><meta content=article property=og:type><meta content=https://hx.raskell.io/docs/docs/development/testing/ property=og:url><meta content=Testing property=og:title><meta property=og:description><meta content="hx Documentation" property=og:site_name><meta content=en property=og:locale><meta content=summary_large_image name=twitter:card><meta content=https://hx.raskell.io/docs/docs/development/testing/ name=twitter:url><meta content=Testing name=twitter:title><meta name=twitter:description><script type=application/ld+json>
    {
        "@context": "https://schema.org",
        "@graph": [
            {
                "@type": "WebSite",
                "@id": "https://hx.raskell.io/docs#website",
                "url": "https://hx.raskell.io/docs",
                "name": "hx Documentation",
                "description": "Documentation for hx, the extremely fast Haskell package and project manager.",
                
                "author": {
                    "@type": "Person",
                    "name": "raskell.io"
                },
                
                "inLanguage": "en"
            },
            {
                "@type": "WebPage",
                "@id": "https://hx.raskell.io/docs/docs/development/testing/#webpage",
                "url": "https://hx.raskell.io/docs/docs/development/testing/",
                "name": "Testing",
                "isPartOf": {
                    "@id": "https://hx.raskell.io/docs#website"
                },
                "description": "",
                "inLanguage": "en"
                
                
            }
            
            ,{
                "@type": "Article",
                "@id": "https://hx.raskell.io/docs/docs/development/testing/#article",
                "isPartOf": {
                    "@id": "https://hx.raskell.io/docs/docs/development/testing/#webpage"
                },
                "headline": "Testing",
                
                
                
                
                "author": {
                    "@type": "Person",
                    "name": "raskell.io"
                },
                
                
                
                "wordCount": 658,
                
                "inLanguage": "en"
            }
            
        ]
    }
    </script><script type=application/ld+json>
    {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [
            {
                "@type": "ListItem",
                "position": 1,
                "name": "hx Documentation",
                "item": "https://hx.raskell.io/docs"
            }
            
            
            
            ,{
                "@type": "ListItem",
                "position": 2,
                "name": "hx Documentation",
                "item": "https://hx.raskell.io/docs/"
            }
            
            
            
            ,{
                "@type": "ListItem",
                "position": 2,
                "name": "Documentation",
                "item": "https://hx.raskell.io/docs/docs/"
            }
            
            
            
            ,{
                "@type": "ListItem",
                "position": 2,
                "name": "Development",
                "item": "https://hx.raskell.io/docs/docs/development/"
            }
            
            
            ,{
                "@type": "ListItem",
                "position": 5,
                "name": "Testing",
                "item": "https://hx.raskell.io/docs/docs/development/testing/"
            }
        ]
    }
    </script><link href=https://hx.raskell.io/docs/style.css rel=stylesheet><link as=font crossorigin href=https://hx.raskell.io/docs/fonts/Geist-Variable.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://hx.raskell.io/docs/fonts/GeistMono-Variable.woff2 rel=preload type=font/woff2><script>(()=>{let c=`auto`;try{var a=localStorage.getItem(`tanuki-theme`)||c;var b=a===c?(window.matchMedia(`(prefers-color-scheme: dark)`).matches?`dark`:`light`):a;document.documentElement.setAttribute(`data-theme`,b);document.documentElement.setAttribute(`data-theme-setting`,a)}catch(a){}})()</script><body class=page-testing><a class=skip-link href=#main-content>Skip to main content</a><div class="layout layout--docs layout--fixed-header" data-mode=docs><aside aria-labelledby=sidebar-title class=sidebar id=sidebar role=complementary><div title="Drag to resize sidebar width" aria-hidden=true class=sidebar__resize-handle></div><div class=sidebar__header><span class=sidebar__title id=sidebar-title>Table of contents</span><button aria-label="Close sidebar" class=sidebar__close title=Close type=button><svg viewbox="0 0 24 24" aria-hidden=true fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg></button></div><nav aria-label="Documentation navigation" class=sidebar__content><div class=toc><div class=toc__section><div class=toc__section-title>Getting Started</div><ul class=toc__list><li class=toc__item><a class=toc__link href=https://hx.raskell.io/docs/docs/installation/> Installation </a><li class=toc__item><a class=toc__link href=https://hx.raskell.io/docs/docs/quickstart/> Quick Start </a></ul></div><div class=toc__section><div class=toc__section-title>Commands Reference</div><ul class=toc__list><li class=toc__item><a class=toc__link href=https://hx.raskell.io/docs/docs/commands/build/> hx build </a><li class=toc__item><a class=toc__link href=https://hx.raskell.io/docs/docs/commands/run/> hx run </a><li class=toc__item><a class=toc__link href=https://hx.raskell.io/docs/docs/commands/test/> hx test </a><li class=toc__item><a class=toc__link href=https://hx.raskell.io/docs/docs/commands/bench/> hx bench </a><li class=toc__item><a class=toc__link href=https://hx.raskell.io/docs/docs/commands/check/> hx check </a><li class=toc__item><a class=toc__link href=https://hx.raskell.io/docs/docs/commands/repl/> hx repl </a><li class=toc__item><a class=toc__link href=https://hx.raskell.io/docs/docs/commands/doc/> hx doc </a><li class=toc__item><a class=toc__link href=https://hx.raskell.io/docs/docs/commands/new/> hx new </a><li class=toc__item><a class=toc__link href=https://hx.raskell.io/docs/docs/commands/init/> hx init </a><li class=toc__item><a class=toc__link href=https://hx.raskell.io/docs/docs/commands/add/> hx add </a><li class=toc__item><a class=toc__link href=https://hx.raskell.io/docs/docs/commands/remove/> hx remove </a><li class=toc__item><a class=toc__link href=https://hx.raskell.io/docs/docs/commands/update/> hx update </a><li class=toc__item><a class=toc__link href=https://hx.raskell.io/docs/docs/commands/lock/> hx lock </a><li class=toc__item><a class=toc__link href=https://hx.raskell.io/docs/docs/commands/sync/> hx sync </a><li class=toc__item><a class=toc__link href=https://hx.raskell.io/docs/docs/commands/outdated/> hx outdated </a><li class=toc__item><a class=toc__link href=https://hx.raskell.io/docs/docs/commands/toolchain/> hx toolchain </a><li class=toc__item><a class=toc__link href=https://hx.raskell.io/docs/docs/commands/clean/> hx clean </a><li class=toc__item><a class=toc__link href=https://hx.raskell.io/docs/docs/commands/fmt/> hx fmt </a><li class=toc__item><a class=toc__link href=https://hx.raskell.io/docs/docs/commands/lint/> hx lint </a><li class=toc__item><a class=toc__link href=https://hx.raskell.io/docs/docs/commands/watch/> hx watch </a><li class=toc__item><a class=toc__link href=https://hx.raskell.io/docs/docs/commands/doctor/> hx doctor </a></ul></div><div class=toc__section><div class=toc__section-title>Configuration Reference</div><ul class=toc__list><li class=toc__item><a class=toc__link href=https://hx.raskell.io/docs/docs/configuration/hx-toml/> hx.toml Reference </a><li class=toc__item><a class=toc__link href=https://hx.raskell.io/docs/docs/configuration/lockfile/> Lockfile Reference </a><li class=toc__item><a class=toc__link href=https://hx.raskell.io/docs/docs/configuration/environment/> Environment Variables </a></ul></div><div class=toc__section><div class=toc__section-title>Features</div><ul class=toc__list><li class=toc__item><a class=toc__link href=https://hx.raskell.io/docs/docs/features/compiler-backends/> Compiler Backends </a><li class=toc__item><a class=toc__link href=https://hx.raskell.io/docs/docs/features/cross-compilation/> Cross-Compilation </a><li class=toc__item><a class=toc__link href=https://hx.raskell.io/docs/docs/features/toolchain/> Toolchain Management </a><li class=toc__item><a class=toc__link href=https://hx.raskell.io/docs/docs/features/lockfiles/> Lockfiles </a><li class=toc__item><a class=toc__link href=https://hx.raskell.io/docs/docs/features/watch-mode/> Watch Mode </a><li class=toc__item><a class=toc__link href=https://hx.raskell.io/docs/docs/features/formatting-linting/> Formatting & Linting </a></ul></div><div class=toc__section><div class=toc__section-title>Concepts</div><ul class=toc__list><li class=toc__item><a class=toc__link href=https://hx.raskell.io/docs/docs/concepts/project-structure/> Project Structure </a><li class=toc__item><a class=toc__link href=https://hx.raskell.io/docs/docs/concepts/dependency-resolution/> Dependency Resolution </a><li class=toc__item><a class=toc__link href=https://hx.raskell.io/docs/docs/concepts/build-system/> Build System </a><li class=toc__item><a class=toc__link href=https://hx.raskell.io/docs/docs/concepts/architecture/> Architecture </a></ul></div><div class=toc__section><div class=toc__section-title>Guides</div><ul class=toc__list><li class=toc__item><a class=toc__link href=https://hx.raskell.io/docs/docs/guides/ci-cd/> CI/CD Setup </a><li class=toc__item><a class=toc__link href=https://hx.raskell.io/docs/docs/guides/migrating-from-stack/> Migrating from Stack </a><li class=toc__item><a class=toc__link href=https://hx.raskell.io/docs/docs/guides/migrating-from-cabal/> Migrating from Cabal </a><li class=toc__item><a class=toc__link href=https://hx.raskell.io/docs/docs/guides/creating-library/> Creating a Library </a><li class=toc__item><a class=toc__link href=https://hx.raskell.io/docs/docs/guides/development-workflow/> Development Workflow </a><li class=toc__item><a class=toc__link href=https://hx.raskell.io/docs/docs/guides/troubleshooting/> Troubleshooting </a></ul></div><div class=toc__section><div class=toc__section-title>Development</div><ul class=toc__list><li class=toc__item><a class=toc__link href=https://hx.raskell.io/docs/docs/development/benchmarks/> Benchmarks </a><li class=toc__item><a class="toc__link active" href=https://hx.raskell.io/docs/docs/development/testing/> Testing </a></ul></div><div class=toc__section><div class=toc__section-title>On this page</div><ul class=toc__list><li class=toc__item><a class=toc__link href=#test-suite> Test Suite </a> <ul class="toc__list toc__list--nested"><li class=toc__item><a class=toc__link href=#test-suite-overview> Test Suite Overview </a><li class=toc__item><a class=toc__link href=#running-tests> Running Tests </a><li class=toc__item><a class=toc__link href=#test-categories> Test Categories </a><li class=toc__item><a class=toc__link href=#test-infrastructure> Test Infrastructure </a><li class=toc__item><a class=toc__link href=#ci-cd-pipeline> CI/CD Pipeline </a><li class=toc__item><a class=toc__link href=#coverage-targets> Coverage Targets </a><li class=toc__item><a class=toc__link href=#test-commands-by-crate> Test Commands by Crate </a><li class=toc__item><a class=toc__link href=#writing-tests> Writing Tests </a><li class=toc__item><a class=toc__link href=#debugging-failed-tests> Debugging Failed Tests </a><li class=toc__item><a class=toc__link href=#contributing-tests> Contributing Tests </a><li class=toc__item><a class=toc__link href=#related-pages> Related Pages </a></ul></ul></div></div></nav><div class=sidebar__footer><div class=sidebar__actions-mobile><div class=sidebar__action><span class=sidebar__action-label>Theme</span><button aria-label="Toggle color theme: cycles through light, dark, and auto modes" title="Toggle theme" aria-live=polite class=theme-toggle type=button><span class=theme-toggle__icons> <span aria-hidden=true class=theme-toggle__sun> <svg viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><circle cx=12 cy=12 r=4 /><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg> </span> <span aria-hidden=true class=theme-toggle__moon> <svg viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg> </span> <span aria-hidden=true class=theme-toggle__auto> <svg viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><circle cx=12 cy=12 r=10 /><path d="M12 2a7 7 0 1 0 7 7"/></svg> </span> </span> <span class="sr-only theme-toggle__status">Current theme: auto</span></button></div><a aria-label="View project on GitHub (opens in new tab)" rel="noopener noreferrer" class=sidebar__github href=https://github.com/raskell-io/hx target=_blank> <svg viewbox="0 0 24 24" aria-hidden=true fill=none height=20 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=20 xmlns=http://www.w3.org/2000/svg><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></svg> <span>View on GitHub</span> </a></div><a aria-label="Print all documentation pages (opens print dialog)" href="https://hx.raskell.io/docs/print?auto=true" class=print-button rel=noopener target=_blank> <svg viewbox="0 0 24 24" aria-hidden=true fill=none height=20 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=20 xmlns=http://www.w3.org/2000/svg><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect height=8 width=12 x=6 y=14 /></svg> <span>Print all pages</span> </a></div></aside><div class=layout__main><header class=header role=banner><div class=header__left><button aria-label="Toggle sidebar navigation" title="Toggle sidebar" aria-controls=sidebar aria-expanded=true class=sidebar-toggle type=button><svg class="sidebar-toggle__icon sidebar-toggle__icon--open" viewbox="0 0 24 24" aria-hidden=true fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><rect height=18 rx=2 width=18 x=3 y=3 /><path d="M9 3v18"/><path d="m16 15-3-3 3-3"/></svg> <svg class="sidebar-toggle__icon sidebar-toggle__icon--closed" viewbox="0 0 24 24" aria-hidden=true fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><rect height=18 rx=2 width=18 x=3 y=3 /><path d="M9 3v18"/><path d="m14 9 3 3-3 3"/></svg></button><button aria-label="Open table of contents" class="toc-toggle toc-toggle--docs" title="Table of contents" aria-controls=sidebar aria-expanded=false type=button><svg viewbox="0 0 24 24" aria-hidden=true fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><rect height=18 rx=2 width=18 x=3 y=3 /><path d="M9 3v18"/><path d="m16 15-3-3 3-3"/></svg></button><a aria-label="hx Documentation - Go to homepage" class=header__logo href=https://hx.raskell.io/docs> <span class=brand-text>hx Documentation</span> </a></div><nav aria-label="Main navigation" class=header__nav role=navigation><a class=header__link href=https://hx.raskell.io> Home </a><a class=header__link href=https://github.com/raskell-io/hx> GitHub </a></nav><div aria-label="Site actions" class=header__actions role=group><button aria-label="Open search dialog" title="Search (press /)" aria-haspopup=dialog aria-keyshortcuts=/ class=search-toggle type=button><svg viewbox="0 0 24 24" aria-hidden=true fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><circle cx=11 cy=11 r=8 /><path d="m21 21-4.3-4.3"/></svg></button><div class=header__actions-desktop><button aria-label="Toggle color theme: cycles through light, dark, and auto modes" title="Toggle theme" aria-live=polite class=theme-toggle type=button><span class=theme-toggle__icons> <span aria-hidden=true class=theme-toggle__sun> <svg viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><circle cx=12 cy=12 r=4 /><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg> </span> <span aria-hidden=true class=theme-toggle__moon> <svg viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg> </span> <span aria-hidden=true class=theme-toggle__auto> <svg viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><circle cx=12 cy=12 r=10 /><path d="M12 2a7 7 0 1 0 7 7"/></svg> </span> </span> <span class="sr-only theme-toggle__status">Current theme: auto</span></button><a aria-label="View project on GitHub (opens in new tab)" class="btn btn--icon btn--ghost" rel="noopener noreferrer" href=https://github.com/raskell-io/hx target=_blank title=GitHub> <svg viewbox="0 0 24 24" aria-hidden=true fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></svg> </a></div></div></header><nav aria-label="Page navigation" class=nav-buttons><a aria-label="Previous: Benchmarks" class="nav-button nav-button--prev" href=https://hx.raskell.io/docs/docs/development/benchmarks/> <svg viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="m15 18-6-6 6-6"/></svg> <span class=nav-button__label> Benchmarks <span class=nav-button__shortcut>←</span> </span> </a><div class="nav-button nav-button--next disabled" aria-hidden=true><svg viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="m9 18 6-6-6-6"/></svg></div></nav><main aria-label="Main content" class=main-content id=main-content role=main><article aria-labelledby=article-title class=article itemscope itemtype=https://schema.org/Article><header class="article__header article__header--docs"><h1 id=article-title itemprop=headline>Testing</h1></header><div class=article__content itemprop=articleBody><h1 id=test-suite>Test Suite</h1><p>hx maintains high quality through comprehensive testing. This page documents our test strategy, how to run tests, and how to contribute.<hr><h2 id=test-suite-overview>Test Suite Overview</h2><table><thead><tr><th>Category<th>Count<th>Framework<th>Location<tbody><tr><td>Unit tests<td>430+<td>Rust <code>#[test]</code><td><code>crates/*/src/</code><tr><td>Integration tests<td>35+<td>assert_cmd<td><code>crates/*/tests/</code><tr><td>Solver benchmarks<td>6<td>Criterion<td><code>crates/hx-solver/benches/</code><tr><td>CLI benchmarks<td>7<td>Criterion<td><code>crates/hx-cli/benches/</code><tr><td>Snapshot tests<td>15+<td>insta<td>Various</table><hr><h2 id=running-tests>Running Tests</h2><h3 id=all-tests>All Tests</h3><pre class=language-bash data-lang=bash><code class=language-bash data-lang=bash># Run entire test suite
cargo test --workspace

# With output
cargo test --workspace -- --nocapture

# Single crate
cargo test -p hx-config
</code></pre><h3 id=integration-tests-only>Integration Tests Only</h3><pre class=language-bash data-lang=bash><code class=language-bash data-lang=bash># All integration tests
cargo test --workspace --test '*'

# Specific test file
cargo test -p hx-cli --test e2e_workflows
</code></pre><h3 id=benchmarks>Benchmarks</h3><pre class=language-bash data-lang=bash><code class=language-bash data-lang=bash># Solver benchmarks
cargo bench -p hx-solver

# CLI benchmarks
cargo bench -p hx-cli

# View HTML reports
open target/criterion/report/index.html
</code></pre><hr><h2 id=test-categories>Test Categories</h2><h3 id=1-unit-tests>1. Unit Tests</h3><p>Unit tests verify individual functions and modules in isolation. They’re located alongside the code in <code>#[cfg(test)]</code> modules.<p><strong>Well-Tested Areas:</strong><ul><li>Configuration parsing (<code>hx-config</code>)<li>Version handling (<code>hx-core</code>)<li>Dependency resolution (<code>hx-solver</code>)<li>Cabal output parsing (<code>hx-cabal</code>)<li>Toolchain detection (<code>hx-toolchain</code>)</ul><p><strong>Example:</strong><pre class=language-rust data-lang=rust><code class=language-rust data-lang=rust>#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn test_parse_version() {
        let v: Version = "1.2.3".parse().unwrap();
        assert_eq!(v.major, 1);
        assert_eq!(v.minor, 2);
        assert_eq!(v.patch, 3);
    }
}
</code></pre><hr><h3 id=2-integration-tests>2. Integration Tests</h3><p>End-to-end tests verify complete workflows by invoking the actual <code>hx</code> binary.<p><strong>Location:</strong> <code>crates/hx-cli/tests/e2e_workflows.rs</code><p><strong>Tested Workflows:</strong><ol><li>Project initialization (binary and library)<li>Configuration management<li>Build operations<li>Clean operations<li>Shell completions (bash, zsh, fish)<li>Help system navigation<li>Error handling<li>Verbose and quiet modes<li>Lockfile operations<li>Stackage integration<li>Cross-compilation flags<li>Server/LSP commands<li>Coverage commands</ol><p><strong>Example:</strong><pre class=language-rust data-lang=rust><code class=language-rust data-lang=rust>#[test]
fn test_workflow_create_build_simple() {
    let temp = TempDir::new().unwrap();
    let project_dir = temp.path().join("simple-app");

    // Initialize project
    hx().args(["init", "--name", "simple-app"])
        .arg(&project_dir)
        .assert()
        .success();

    // Verify structure
    assert!(project_dir.join("hx.toml").exists());
    assert!(project_dir.join("simple-app.cabal").exists());
    assert!(project_dir.join("src/Main.hs").exists());

    // Run doctor
    hx().current_dir(&project_dir)
        .arg("doctor")
        .assert()
        .success();
}
</code></pre><hr><h3 id=3-snapshot-tests>3. Snapshot Tests</h3><p>Snapshot tests verify output stability using the <code>insta</code> crate. When output changes, you review and approve the diff.<p><strong>Use Cases:</strong><ul><li>Error message formatting<li>Diagnostic output<li>Generated files</ul><p><strong>Example:</strong><pre class=language-rust data-lang=rust><code class=language-rust data-lang=rust>#[test]
fn test_error_output_format() {
    let error = ConfigError::NotFound { path: "hx.toml".into() };
    insta::assert_snapshot!(format_error(&error));
}
</code></pre><p><strong>Managing Snapshots:</strong><pre class=language-bash data-lang=bash><code class=language-bash data-lang=bash># Review and update snapshots
cargo insta review

# Update all snapshots
cargo insta accept
</code></pre><hr><h3 id=4-benchmarks>4. Benchmarks</h3><p>Performance benchmarks using the Criterion framework.<p><strong>Solver Benchmarks (<code>hx-solver</code>):</strong><ul><li>Simple resolution (10 packages, 3 versions)<li>Scaling by package count (5, 10, 20, 50 packages)<li>Scaling by version count (3, 5, 10, 20 versions)<li>Multiple dependency resolution<li>Index creation</ul><p><strong>CLI Benchmarks (<code>hx-cli</code>):</strong><ul><li>Startup time (–help, –version)<li>Project initialization (binary, library)<li>Configuration parsing<li>Clean operations<li>Shell completions (bash, zsh, fish)<li>Lockfile operations</ul><p>See the <a href=/docs/development/benchmarks>Benchmarks</a> page for detailed results.<hr><h2 id=test-infrastructure>Test Infrastructure</h2><h3 id=frameworks>Frameworks</h3><table><thead><tr><th>Framework<th>Purpose<tbody><tr><td><code>#[test]</code><td>Built-in Rust unit testing<tr><td><code>#[tokio::test]</code><td>Async test support<tr><td><code>assert_cmd</code><td>CLI integration testing<tr><td><code>predicates</code><td>Output assertions<tr><td><code>tempfile</code><td>Temporary directory management<tr><td><code>insta</code><td>Snapshot testing<tr><td><code>criterion</code><td>Performance benchmarking</table><h3 id=test-fixtures>Test Fixtures</h3><p>Fixtures are stored in <code>crates/&LTcrate>/fixtures/</code>:<pre><code>fixtures/
├── hx.toml/
│   ├── minimal.toml
│   ├── full.toml
│   └── invalid.toml
├── cabal-output/
│   ├── build-success.txt
│   └── build-failure.txt
└── lockfiles/
    ├── simple.lock
    └── complex.lock
</code></pre><h3 id=mocking-external-tools>Mocking External Tools</h3><p>For tests that need to mock GHC or other tools:<pre class=language-rust data-lang=rust><code class=language-rust data-lang=rust>fn with_mock_ghc&LTF: FnOnce()>(version: &str, f: F) {
    let mock_dir = create_mock_ghc(version);
    let original_path = env::var("PATH").unwrap();
    env::set_var("PATH", format!("{}:{}", mock_dir.display(), original_path));
    f();
    env::set_var("PATH", original_path);
}
</code></pre><hr><h2 id=ci-cd-pipeline>CI/CD Pipeline</h2><h3 id=continuous-integration>Continuous Integration</h3><p>Every commit and PR runs:<ol><li><p><strong>Lint Job</strong></p> <ul><li><code>cargo fmt --all -- --check</code><li><code>cargo clippy --workspace --all-targets -- -D warnings</code></ul><li><p><strong>Test Job</strong> (3 platforms)</p> <ul><li><code>cargo build --workspace</code><li><code>cargo test --workspace</code><li>Platforms: Ubuntu, macOS, Windows</ul><li><p><strong>Release Build</strong></p> <ul><li><code>cargo build --release --workspace</code></ul><li><p><strong>Documentation</strong></p> <ul><li><code>cargo doc --workspace --no-deps</code><li>RUSTDOCFLAGS: <code>-D warnings</code></ul></ol><h3 id=platform-matrix>Platform Matrix</h3><table><thead><tr><th>Platform<th>Status<tbody><tr><td>ubuntu-latest<td>Full support<tr><td>macos-latest<td>Full support<tr><td>windows-latest<td>Partial (some tests skipped)</table><h3 id=release-pipeline>Release Pipeline</h3><p>Release builds target 6 platforms:<ul><li><code>x86_64-unknown-linux-gnu</code><li><code>x86_64-unknown-linux-musl</code><li><code>aarch64-unknown-linux-gnu</code><li><code>x86_64-apple-darwin</code><li><code>aarch64-apple-darwin</code><li><code>x86_64-pc-windows-msvc</code></ul><hr><h2 id=coverage-targets>Coverage Targets</h2><table><thead><tr><th>Crate<th>Target<th>Current<tbody><tr><td>hx-config<td>80%<td>~85%<tr><td>hx-lock<td>80%<td>~82%<tr><td>hx-solver<td>75%<td>~78%<tr><td>hx-cabal<td>70%<td>~75%<tr><td>hx-toolchain<td>70%<td>~72%<tr><td>hx-cli<td>60%<td>~65%</table><hr><h2 id=test-commands-by-crate>Test Commands by Crate</h2><h3 id=hx-config>hx-config</h3><pre class=language-bash data-lang=bash><code class=language-bash data-lang=bash>cargo test -p hx-config

# Key tests:
# - TOML parsing
# - Default merging
# - Project root detection
# - Validation
</code></pre><h3 id=hx-solver>hx-solver</h3><pre class=language-bash data-lang=bash><code class=language-bash data-lang=bash>cargo test -p hx-solver
cargo bench -p hx-solver

# Key tests:
# - Version constraint parsing
# - Dependency resolution
# - Build plan generation
# - Hackage index loading
</code></pre><h3 id=hx-cli>hx-cli</h3><pre class=language-bash data-lang=bash><code class=language-bash data-lang=bash>cargo test -p hx-cli
cargo bench -p hx-cli

# Key tests:
# - Command argument parsing
# - Help output
# - Project initialization
# - End-to-end workflows
</code></pre><h3 id=hx-cabal>hx-cabal</h3><pre class=language-bash data-lang=bash><code class=language-bash data-lang=bash>cargo test -p hx-cabal

# Key tests:
# - Cabal file parsing
# - GHC output parsing
# - Diagnostic extraction
# - Build state management
</code></pre><hr><h2 id=writing-tests>Writing Tests</h2><h3 id=guidelines>Guidelines</h3><ol><li><p><strong>Test one thing per test</strong></p> <pre class=language-rust data-lang=rust><code class=language-rust data-lang=rust>#[test]
fn test_parse_simple_version() { ... }

#[test]
fn test_parse_version_with_prerelease() { ... }
</code></pre><li><p><strong>Use descriptive names</strong></p> <pre class=language-rust data-lang=rust><code class=language-rust data-lang=rust>// Good
#[test]
fn test_parse_config_missing_toolchain_section() { ... }

// Bad
#[test]
fn test1() { ... }
</code></pre><li><p><strong>Test error cases</strong></p> <pre class=language-rust data-lang=rust><code class=language-rust data-lang=rust>#[test]
fn test_parse_invalid_version_returns_error() {
    let result = "not.a.version".parse::&LTVersion>();
    assert!(result.is_err());
}
</code></pre><li><p><strong>Use fixtures for complex inputs</strong></p> <pre class=language-rust data-lang=rust><code class=language-rust data-lang=rust>#[test]
fn test_parse_complex_config() {
    let content = include_str!("../fixtures/hx.toml/full.toml");
    let config: Config = toml::from_str(content).unwrap();
    // assertions...
}
</code></pre></ol><h3 id=adding-new-tests>Adding New Tests</h3><ol><li>Add test in appropriate <code>#[cfg(test)]</code> module<li>Run <code>cargo test -p &LTcrate></code> to verify<li>Run <code>cargo fmt</code> and <code>cargo clippy</code><li>Submit PR</ol><hr><h2 id=debugging-failed-tests>Debugging Failed Tests</h2><h3 id=verbose-output>Verbose Output</h3><pre class=language-bash data-lang=bash><code class=language-bash data-lang=bash># Show println! output
cargo test -- --nocapture

# Show test names as they run
cargo test -- --test-threads=1

# Run single test
cargo test test_parse_config
</code></pre><h3 id=snapshot-updates>Snapshot Updates</h3><pre class=language-bash data-lang=bash><code class=language-bash data-lang=bash># Review and update snapshots
cargo insta review

# Update all snapshots
cargo insta accept
</code></pre><h3 id=benchmark-comparison>Benchmark Comparison</h3><pre class=language-bash data-lang=bash><code class=language-bash data-lang=bash># Compare against baseline
cargo bench -- --save-baseline master
git checkout feature-branch
cargo bench -- --baseline master
</code></pre><hr><h2 id=contributing-tests>Contributing Tests</h2><p>We welcome test contributions:<ol><li><strong>Add missing unit tests</strong> for uncovered code paths<li><strong>Add integration tests</strong> for new features<li><strong>Add regression tests</strong> for fixed bugs<li><strong>Improve test documentation</strong></ol><h3 id=test-contribution-checklist>Test Contribution Checklist</h3><ul><li><input disabled type=checkbox> Test passes locally<li><input disabled type=checkbox> Test has descriptive name<li><input disabled type=checkbox> Test verifies one specific behavior<li><input disabled type=checkbox> Test includes error cases where appropriate<li><input disabled type=checkbox> Test doesn’t depend on external state<li><input disabled type=checkbox> Test cleans up after itself</ul><p>Submit test improvements: <a rel="noopener nofollow noreferrer" href=https://github.com/raskell-io/hx/pulls target=_blank>GitHub PRs</a><hr><h2 id=related-pages>Related Pages</h2><ul><li><a href=/docs/development/benchmarks>Benchmarks</a> — Performance measurements<li><a rel="noopener nofollow noreferrer" href=https://github.com/raskell-io/hx/blob/main/CONTRIBUTING.md target=_blank>Contributing</a> — How to contribute</ul></div><meta content=raskell.io itemprop=author></article><nav aria-label="Page navigation" class=page-nav></nav></main></div></div><div aria-hidden=true class=sidebar-overlay></div><div aria-describedby=search-description aria-labelledby=search-title aria-modal=true class=search-overlay role=dialog><div class=search><h2 class=sr-only id=search-title>Search documentation</h2><p class=sr-only id=search-description>Type to search. Use arrow keys to navigate results, Enter to select, Escape to close.<div class=search__input-wrapper><span aria-hidden=true class=search__icon> <svg viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><circle cx=11 cy=11 r=8 /><path d="m21 21-4.3-4.3"/></svg> </span><input aria-label="Search query" placeholder="Search documentation..." aria-autocomplete=list aria-controls=search-results autocomplete=off autofocus class=search__input type=search><span aria-hidden=true class=search__shortcut>/</span><button aria-label="Close search dialog" title="Close (Esc)" class=search__close type=button><svg viewbox="0 0 24 24" aria-hidden=true fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg></button></div><div aria-label="Search results" class=search__results id=search-results role=listbox></div><footer class=search__footer><nav aria-label="Keyboard shortcuts" class=search__hints><span class=search__hint> <kbd aria-label="Up and down arrows">↑</kbd><kbd aria-hidden=true>↓</kbd> <span>Navigate</span> </span><span class=search__hint> <kbd aria-label=Enter>↵</kbd> <span>Select</span> </span><span class=search__hint> <kbd aria-label=Escape>esc</kbd> <span>Close</span> </span></nav><span class=search__powered-by>Powered by <a aria-label="elasticlunr.js on GitHub (opens in new tab)" rel="noopener noreferrer" href=https://github.com/weixsong/elasticlunr.js target=_blank>elasticlunr</a></span></footer></div></div><button aria-label="Scroll to top" class="fab scroll-to-top" title="Scroll to top"><svg viewbox="0 0 24 24" aria-hidden=true fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="m18 15-6-6-6 6"/></svg></button><script defer src=https://hx.raskell.io/docs/js/theme.js></script><script defer src=https://hx.raskell.io/docs/js/navigation.js></script><script defer src=https://hx.raskell.io/docs/js/code.js></script><script src=https://hx.raskell.io/docs/elasticlunr.min.js></script><script src=https://hx.raskell.io/docs/search_index.en.js></script><script defer src=https://hx.raskell.io/docs/js/search.js></script>